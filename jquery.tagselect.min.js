/*
* jQuery TagSelect Plugin
*
* Copyright (c) 2011 Po-Huan, Lin a.k.a Linmic
* Mail: linmicya@gmail.com
*
* Licensed under MIT licenses:
*     http://www.opensource.org/licenses/mit-license.php
* Version: v0.2 2010-05-04
*
*/
(function(d){d.fn.extend({tagselect:function(i,c,e,f,k){function n(b){var a=typeof b;a==="object"&&(b?b instanceof Array&&(a="array"):a="null");return a}function o(b,a){var c=d.trim(b.toLowerCase()).split(a),e;for(e in c)c.hasOwnProperty(e)&&(c[e]=d.trim(c[e]));return c}function l(b){g.indexOfIg(b)==-1&&g.push(d.trim(b))}function j(){var b=o(e.val(),c);g=[];if(d.trim(e.val())!="")for(var a in b)b.hasOwnProperty(a)&&b[a]!=""&&l(b[a]);m.find("a").each(function(){b.indexOfIg(d(this).text())==-1?d(this).removeClass("active"):
d(this).addClass("active")})}Array.prototype.indexOfIg=function(b){if(n(b)!=="string")return!1;var b=b.toLowerCase(),a;for(a in this)this.hasOwnProperty(a)&&(this[a]=this[a].toLowerCase());return this.indexOf(b)};if(n(i)!=="array"||c!=","&&c!=" ")return!1;this.defaults={sep:" ",$input:d("#input1"),ac_enable:!1,ac_css:"http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.12/themes/base/jquery-ui.css"};var c=!c?this.defaults.sep:c,e=!e?this.defaults.$input:e,f=!f?this.defaults.ac_enable:f,m=this,g=[];
f==!0&&typeof e.autocomplete=="function"&&(f=!k?"http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.12/themes/base/jquery-ui.css":k,d("link#jqueryui_css").length==0&&(d("head").append("<link>"),d("head").children(":last").attr({id:"jqueryui_css",rel:"stylesheet",type:"text/css",href:f})),e.autocomplete({minLength:0,source:function(b,a){a(d.ui.autocomplete.filter(i,(c===","?b.term.split(/,\s*/):c===" "?b.term.split(/\s+/):b.term.split(c)).pop()))},focus:function(b){b.preventDefault()},select:function(b,
a){arr=g;arr.push(a.item.value);this.value=arr.join(c);e.focus().val(d.trim(g.join(c)));j();b.preventDefault()}}));f=0;for(k=i.length;f<k;f++)m.append('<a id="tag_'+f+'" href="#">'+i[f]+"</a>");e.bind("change, click",function(){j()}).bind("keyup",function(b){d.trim(e.val())==""&&j();switch(b.keyCode){case 32:case 188:c!=","&&j()}});m.find("a").bind("click",function(b){var a=d(this),f=d.trim(a.text());a.hasClass("active")?(a.removeClass("active"),g.indexOfIg(f)!=-1&&(a=g.indexOfIg(d.trim(f)),a!=-1&&
g.splice(a,1))):(a.addClass("active"),l(f));var a=o(e.val(),c),h;for(h in a)g.indexOfIg(a[h])===-1&&i.indexOfIg(a[h])===-1&&a[h]!==""&&a[h]!=f&&l(a[h]);e.focus().val(d.trim(g.join(c)));b.preventDefault()});e.focus(function(){this.value=this.value});j()}})})(jQuery);
