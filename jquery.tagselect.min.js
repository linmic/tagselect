/*
* jQuery TagSelect Plugin
*
* Copyright (c) 2011 Po-Huan, Lin a.k.a Linmic
* Mail: linmicya@gmail.com
*
* Licensed under MIT licenses:
*     http://www.opensource.org/licenses/mit-license.php
*
*/
(function(d){d.fn.extend({tagselect:function(h,g,c){function m(b){var a=typeof b;a==="object"&&(b?b instanceof Array&&(a="array"):a="null");return a}function n(b,a){var c=d.trim(b.toLowerCase()).split(a),e;for(e in c)isNaN(e)||(c[e]=d.trim(c[e]));return c}function j(b){f.indexOfIg(b)==-1&&f.push(d.trim(b))}function o(){var b=n(c.val(),g);f=[];if(d.trim(c.val())!="")for(var a in b)b.hasOwnProperty(a)&&b[a]!=""&&j(b[a]);k.find("a").each(function(){b.indexOfIg(d(this).text())==-1?d(this).removeClass("active"):
d(this).addClass("active")})}if(m(h)!="array")return!1;this.defaults={sep:",",$input:d("#input1")};var g=!g?this.defaults.sep:g,c=!c?this.defaults.$input:c,k=this,f=[],p={width:320,max:4,highlight:!1,multiple:!0,multipleSeparator:g,scroll:!0,scrollHeight:300};Array.prototype.indexOfIg=function(b){if(m(b)!="string")return!1;var b=b.toLowerCase(),a;for(a in this)this.hasOwnProperty(a)&&(this[a]=this[a].toLowerCase());return this.indexOf(b)};typeof c.autocomplete=="function"&&(d("head").append("<link>"),
d("head").children(":last").attr({rel:"stylesheet",type:"text/css",href:"http://view.jquery.com/trunk/plugins/autocomplete/jquery.autocomplete.css"}),c.autocomplete(h,p));for(var l in h)h.hasOwnProperty(l)&&k.append('<a id="tag_'+l+'" href="#">'+h[l]+"</a>");c.bind("change, click, keyup",function(){o()});k.find("a").bind("click",function(b){var a=d(this),i=d.trim(a.text());a.hasClass("active")?(a.removeClass("active"),f.indexOfIg(i)!=-1&&(a=f.indexOfIg(d.trim(i)),a!=-1&&f.splice(a,1))):(a.addClass("active"),
j(i));var a=n(c.val(),g),e;for(e in a)f.indexOfIg(a[e])===-1&&h.indexOfIg(a[e])===-1&&a[e]!==""&&a[e]!=i&&j(a[e]);c.focus().val(d.trim(f.join(g)));b.preventDefault()});c.focus(function(){this.value=this.value});o()}})})(jQuery);
